# 尚硅谷Vue项目实战——尚品汇

**GitHub代码地址**

https://github.com/chenzhengqingzzz/shangpinhuishop

# **前端Vue核心**

用Vue开发一个前端模块可以概括为以下几个步骤：

	1. 写静态页面、拆分静态组件
	1. 发请求（API）
	1. vuex(actions/mutations/state三连操作)
	1. 组件获取仓库数据，动态展示

# 1. vue文件目录分析

**public文件夹：**静态资源，webpack进行打包的时候会原封不动打包到dist文件夹中

**public/index.html**是一个模板文件，作用是生成项目的入口文件，webpack打包的js，css，也会自动注入到该页面中。我们浏览器访问项目的时候就会默认打开生成好的index.html

**src文件夹（程序员代码文件夹）**

```
assets： 存放公用的静态资源（一般放置多个组件公用的静态资源）需要注意：放在assets文件夹里面的静态资源在webpack打包的时候会被当做模块打包到JS文件里面
components： 非路由组件（全局组件），其他组件放在views或者pages文件夹中
App.vue： 唯一的根组件
main.js： 程序入口文件，最先执行的文件
babel.config.js: 配置文件（babel相关）
package.json: 项目的详细信息记录
package-lock.json: 缓存性文件（各种包的来源）
```

# 2. 项目配置

## 2.1 项目运行，浏览器自动打开

`src/package.json`

```js
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint"
  },
```

## 2.2 关闭eslint校验工具（不关闭会有各种规范，不按照规范就会报错）

* src根目录创建vue.config.js进行配置

`src/vue.config.js`

```js
module.exports = {
  //关闭eslint
  lintOnSave: false
  }
```

## 2.3 src文件夹简写方法，配置别名

​	`jsconfig.json`配置别名@提示【@代表的是src文件夹，这样将来文件过多，找的时候方便很多，exclude表示不可以使用该别名的文件】

```js
 {
    "compilerOptions": {
        "baseUrl": "./",
            "paths": {
            "@/*": [
                "src/*"
            ]
        }
    },

    "exclude": [
        "node_modules",
        "dist"
    ]
 }
```

# 3. 项目路由的分析

vue-router

前端所谓路由：ket-value键值对

key：URL（地址栏中的路径）

value：相应的路由组件

注意：项目的上中下结构

路由组件：

Home首页路由组件、Search路由组件、Login登录路由组件、Register注册路由组件

非路由组件：

Header【首页、搜索页】

Footer【在首页、搜索页】，但是在登录、注册界面没有

# 4. 组件页面样式

组件页面的样式使用的是less样式，浏览器不识别该样式，需要下载相关依赖

```shell
npm i --save less less-loader
```

如果想让组件识别less样式，则需要在组件中设置

```vue
<style scoped lang="less">
```

`src/components/Header/index.vue`

```vue
<template>
  <!-- 头部 -->
  <header class="header">
    <!-- 头部的第一行 -->
    <div class="top">
      <div class="container">
        <div class="loginList">
          <p>尚品汇欢迎您！</p>
          <p>
            <span>请</span>
            <!-- 只是跳过去，没有别的业务，可以用声明式导航 -->
            <router-link to="/login">登录</router-link>
            <router-link class="register" to="/register">免费注册</router-link>
          </p>
        </div>
        <div class="typeList">
          <a href="###">我的订单</a>
          <a href="###">我的购物车</a>
          <a href="###">我的尚品汇</a>
          <a href="###">尚品汇会员</a>
          <a href="###">企业采购</a>
          <a href="###">关注尚品汇</a>
          <a href="###">合作招商</a>
          <a href="###">商家后台</a>
        </div>
      </div>
    </div>
    <!--头部第二行 搜索区域-->
    <div class="bottom">
      <h1 class="logoArea">
        <router-link class="logo" title="尚品汇" to="/home">
          <img src="./images/logo.png" alt="" />
        </router-link>
      </h1>
      <div class="searchArea">
        <form action="###" class="searchForm">
          <input
            type="text"
            id="autocomplete"
            class="input-error input-xxlarge"
          />
          <button class="sui-btn btn-xlarge btn-danger" type="button" @click="goSearch">
            搜索
          </button>
        </form>
      </div>
    </div>
  </header>
</template>

<script>
export default {
  name: "Header",
  methods: {
    // 搜索按钮的回调函数，需要向Search路由进行跳转
    goSearch(){
      this.$router.push('/search')
    }
  },
};
</script>

<style scoped lang="less">
.header {
  & > .top {
    background-color: #eaeaea;
    height: 30px;
    line-height: 30px;

    .container {
      width: 1200px;
      margin: 0 auto;
      overflow: hidden;

      .loginList {
        float: left;

        p {
          float: left;
          margin-right: 10px;

          .register {
            border-left: 1px solid #b3aeae;
            padding: 0 5px;
            margin-left: 5px;
          }
        }
      }

      .typeList {
        float: right;

        a {
          padding: 0 10px;

          & + a {
            border-left: 1px solid #b3aeae;
          }
        }
      }
    }
  }

  & > .bottom {
    width: 1200px;
    margin: 0 auto;
    overflow: hidden;

    .logoArea {
      float: left;

      .logo {
        img {
          width: 175px;
          margin: 25px 45px;
        }
      }
    }

    .searchArea {
      float: right;
      margin-top: 35px;

      .searchForm {
        overflow: hidden;

        input {
          box-sizing: border-box;
          width: 490px;
          height: 32px;
          padding: 0px 4px;
          border: 2px solid #ea4a36;
          float: left;

          &:focus {
            outline: none;
          }
        }

        button {
          height: 32px;
          width: 68px;
          background-color: #ea4a36;
          border: none;
          color: #fff;
          float: left;
          cursor: pointer;

          &:focus {
            outline: none;
          }
        }
      }
    }
  }
}
</style>

```

<img src="/Users/chenzhengqing/Library/Application Support/typora-user-images/image-20230420210225240.png" alt="image-20230420210225240" style="zoom:50%;" />

`src/components/Footer/index.vue`

```vue
<template>
  <!-- 底部 -->
  <div class="footer">
    <div class="footer-container">
      <div class="footerList">
        <div class="footerItem">
          <h4>购物指南</h4>
          <ul class="footerItemCon">
            <li>购物流程</li>
            <li>会员介绍</li>
            <li>生活旅行/团购</li>
            <li>常见问题</li>
            <li>购物指南</li>
          </ul>
        </div>
        <div class="footerItem">
          <h4>配送方式</h4>
          <ul class="footerItemCon">
            <li>上门自提</li>
            <li>211限时达</li>
            <li>配送服务查询</li>
            <li>配送费收取标准</li>
            <li>海外配送</li>
          </ul>
        </div>
        <div class="footerItem">
          <h4>支付方式</h4>
          <ul class="footerItemCon">
            <li>货到付款</li>
            <li>在线支付</li>
            <li>分期付款</li>
            <li>邮局汇款</li>
            <li>公司转账</li>
          </ul>
        </div>
        <div class="footerItem">
          <h4>售后服务</h4>
          <ul class="footerItemCon">
            <li>售后政策</li>
            <li>价格保护</li>
            <li>退款说明</li>
            <li>返修/退换货</li>
            <li>取消订单</li>
          </ul>
        </div>
        <div class="footerItem">
          <h4>特色服务</h4>
          <ul class="footerItemCon">
            <li>夺宝岛</li>
            <li>DIY装机</li>
            <li>延保服务</li>
            <li>尚品汇E卡</li>
            <li>尚品汇通信</li>
          </ul>
        </div>
        <div class="footerItem">
          <h4>帮助中心</h4>
          <img src="./images/wx_cz.jpg" />
        </div>
      </div>
      <div class="copyright">
        <ul class="helpLink">
          <li>
            关于我们
            <span class="space"></span>
          </li>
          <li>
            联系我们
            <span class="space"></span>
          </li>
          <li>
            关于我们
            <span class="space"></span>
          </li>
          <li>
            商家入驻
            <span class="space"></span>
          </li>
          <li>
            营销中心
            <span class="space"></span>
          </li>
          <li>
            友情链接
            <span class="space"></span>
          </li>
          <li>
            关于我们
            <span class="space"></span>
          </li>
          <li>
            营销中心
            <span class="space"></span>
          </li>
          <li>
            友情链接
            <span class="space"></span>
          </li>
          <li>关于我们</li>
        </ul>
        <p>地址：北京市昌平区宏福科技园综合楼6层</p>
        <p>京ICP备19006430号</p>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "Footer",
};
</script>

<style scoped lang="less" >
.footer {
  background-color: #eaeaea;

  .footer-container {
    width: 1200px;
    margin: 0 auto;
    padding: 0 15px;

    .footerList {
      padding: 20px;
      border-bottom: 1px solid #e4e1e1;
      border-top: 1px solid #e4e1e1;
      overflow: hidden;
      padding-left: 40px;

      .footerItem {
        width: 16.6666667%;
        float: left;

        h4 {
          font-size: 14px;
        }

        .footerItemCon {
          li {
            line-height: 18px;
          }
        }

        &:last-child img {
          width: 121px;
        }
      }
    }

    .copyright {
      padding: 20px;

      .helpLink {
        text-align: center;

        li {
          display: inline;

          .space {
            border-left: 1px solid #666;
            width: 1px;
            height: 13px;
            background: #666;
            margin: 8px 10px;
          }
        }
      }

      p {
        margin: 10px 0;
        text-align: center;
      }
    }
  }
}
</style>
```

![image-20230420210309954](/Users/chenzhengqing/Library/Application Support/typora-user-images/image-20230420210309954.png)

# 4. 清除vue页面默认的样式

引入结构和样式后，会发现我们的样式有些许错位，则需要按照项目的要求清除默认样式

vue是单页面开发，我们只需要修改public下的index.html文件

```html
<link rel="stylesheet" href="reset.css">
```

`app/public/reset.css`

```css
/* @import "./iconfont.css"; */
 
/* 清除内外边距 */
body, h1, h2, h3, h4, h5, h6, hr, p, blockquote,
dl, dt, dd, ul, ol, li,
pre,
fieldset, lengend, button, input, textarea,
th, td {
    margin: 0;
    padding: 0;
}

/* 设置默认字体 */
body,
button, input, select, textarea { /* for ie */
    /*font: 12px/1 Tahoma, Helvetica, Arial, "宋体", sans-serif;*/
    font: 12px/1.3 "Microsoft YaHei",Tahoma, Helvetica, Arial, "\5b8b\4f53", sans-serif; /* 用 ascii 字符表示，使得在任何编码下都无问题 */
    color: #333;
}


h1 { font-size: 18px; /* 18px / 12px = 1.5 */ }
h2 { font-size: 16px; }
h3 { font-size: 14px; }
h4, h5, h6 { font-size: 100%; }

address, cite, dfn, em, var, i{ font-style: normal; } /* 将斜体扶正 */
b, strong{ font-weight: normal; } /* 将粗体扶细 */
code, kbd, pre, samp, tt { font-family: "Courier New", Courier, monospace; } /* 统一等宽字体 */
small { font-size: 12px; } /* 小于 12px 的中文很难阅读，让 small 正常化 */

/* 重置列表元素 */
ul, ol { list-style: none; }

/* 重置文本格式元素 */
a { text-decoration: none; color: #666;}


/* 重置表单元素 */
legend { color: #000; } /* for ie6 */
fieldset, img { border: none; }
button, input, select, textarea {
    font-size: 100%; /* 使得表单元素在 ie 下能继承字体大小 */
}

/* 重置表格元素 */
table {
    border-collapse: collapse;
    border-spacing: 0;
}

/* 重置 hr */
hr {
    border: none;
    height: 1px;
}
.clearFix::after{
	content:"";
	display: block;
	clear:both;
}
/* 让非ie浏览器默认也显示垂直滚动条，防止因滚动条引起的闪烁 */
html { overflow-y: scroll; }

a:link:hover{
    color : rgb(79, 76, 212) !important;
    text-decoration: underline;
}

/* 清除浮动 */
.clearfix::after {
    display: block;
    height: 0;
    content: "";
    clear: both;
    visibility: hidden;
}
```

<img src="/Users/chenzhengqing/Library/Application Support/typora-user-images/image-20230420210344299.png" alt="image-20230420210344299" style="zoom:50%;" />

# 5. pages文件夹

创建pages文件夹，并创建路由组件

`src/pages/Home/index.vue`

`src/pages/Login/index.vue`

`src/pages/Register/index.vue`

`src/pages/Search/index.vue`

## 5.1 创建router文件夹，并创建index.js进行路由配置，最终在main.js中引入注册

`src/router/index.js`

```js
// 路由器，配置路由器的地方
import Vue from "vue";
import VueRouter from "vue-router";
// 使用插件
Vue.use(VueRouter)

// 引入路由组件
import Home from '../pages/Home'
import Search from '@/pages/Search'
import Login from '@/pages/Login'
import Register from '@/pages/Register'
// 配置路由
export default new VueRouter({
    routes: [
        {
            path: '/home',
            component: Home,
        },
        {
            path: '/search',
            component: Search,
        },
        {
            path: '/login',
            component: Login,
        },
        {
            path: '/register',
            component: Register,
        },
        // 重定向，在项目跑起来的时候，访问"/"，立马定向到首页
        {
            path: '*',
            redirect: '/home'
        }
    ]
})
```

<img src="/Users/chenzhengqing/Library/Application Support/typora-user-images/image-20230420210416944.png" alt="image-20230420210416944" style="zoom:50%;" />

## 5.2 总结

路由组件和非路由组件的区别：

* 非路由组件放在components文件夹中，路由组件放在pages或view中
* 非路由组件通过标签使用，路由组件通过路由使用
* 在main.js中注册完路由，所有的路由和非路由组件身上都会拥有`$router`和`$route`属性
* `$router`：一般进行编程式路由导航进行路由跳转
* `$route`：一般获取路由信息（name path params等）

## 5.3 路由跳转方式

* 声明式路由导航：`router-link`标签，可以吧`router-link`理解为一个a标签，它也可以加class修饰

`src/components/Header/index.vue`

```vue
<!-- 只是跳过去，没有别的业务，可以用声明式导航 -->
<router-link to="/login">登录</router-link>
<router-link class="register" to="/register">免费注册</router-link>
```

* 编程式路由导航：声明式路由导航能做的编程式路由导航都能做，而且还可以处理一些业务

`src/components/Header/index.vue`

```vue
<button class="sui-btn btn-xlarge btn-danger" type="button" @click="goSearch">
    搜索
</button>
<script>
  methods: {
    // 搜索按钮的回调函数，需要向Search路由进行跳转
    goSearch(){
      this.$router.push('/search')
    }
  },
</script>
```

# 6. Footer组件的显示与隐藏

* Footer组件在登录、注册页面是不存在的，所以要隐藏，用`v-if`或`v-show`
* 这里使用`v-show`，因为`v-if`会频繁操作DOM元素消耗性能，`v-show`只是通过样式将元素显示或隐藏
* 配置路由的时候，可以给路由配置元信息`meta`
* 在路由的元信息中定义`isShowFooter`属性，用来给`v-show`赋值，判断是否显示footer组件

`src/router/index.js`

```js
    routes: [
        {
            path: '/home',
            component: Home,
            meta: {isShowFooter: true}
        },
        {
            path: '/search',
            component: Search,
            meta: {isShowFooter: true}
        },
        {
            path: '/login',
            component: Login,
            meta: {isShowFooter: false}
        },
        {
            path: '/register',
            component: Register,
            meta: {isShowFooter: false}
        },
        // 重定向，在项目跑起来的时候，访问"/"，立马定向到首页
        {
            path: '*',
            redirect: '/home'
        }
    ]
```

`src/App.vue`

```vue
<Footer v-show="$route.meta.isShowFooter"/>
```

<img src="/Users/chenzhengqing/Library/Application Support/typora-user-images/image-20230420210510513.png" alt="image-20230420210510513" style="zoom:50%;" />

# 7. 路由传参

## 7.1 query、params参数

* query、params两个属性可以传递参数

  * query参数：不属于路径的一部分，类似于get请求，地址栏表现为`...8080/#/search?k1=v1&k2=v2`
  * query参数对应的路由信息：`path: "/search"`
  * params参数：属于路径当中的一部分，需要注意，在配置路由的时候，需要**占位**，地址栏表现为`...8080/#/search/v1/v2`
  * params参数对应的路由信息要修改为：`path: "/search/:keyWord"`这里的`/:keyWord`就是一个params参数的占位符

  **与路由传参的四个相关面试题：**

* 路由传递参数（对象写法）path是否可以结合params参数一起使用？

`src/components/Header/index.vue`

```js
      // 答：路由跳转传参的时候，对象的写法可以使name、path形式，但是需要注意的是：path这种写法是不能与params参数一起使用
      this.$router.push({
        path: '/search',
        params: {keyWord: this.keyWord},
        query: {k: this.keyWord.toUpperCase()}
      })
```

* 如何指定params参数可传可不传？

```js
  如果路由path要求传递params参数,但是没有传递,会发现地址栏URL有问题，详情如下：
  Search路由项的path已经指定要传一个keyword的params参数，如下所示：
  path: "/search/:keyword",
  执行下面进行路由跳转的代码：
  this.$router.push({name:"Search",query:{keyword:this.keyword}})
  当前跳转代码没有传递params参数
  地址栏信息：http://localhost:8080/#/?keyword=asd
  此时的地址信息少了/search
  正常的地址栏信息: http://localhost:8080/#/search?keyword=asd
  解决方法：可以通过改变path来指定params参数可传可不传 
  path: "/search/:keyword?",?表示该参数可传可不传
```

参考连接：https://blog.csdn.net/weixin_44867717/article/details/109773945

* 前面知道了params可传可不传 ，但是如果传递的是空串，如何解决？

```js
 this.$router.push({name:"Search",query:{keyword:this.keyword},params:{keyword:''}})
 出现的问题和2中的问题相同,地址信息少了/search
 解决方法： 加入||undefined，当我们传递的参数为空串时地址栏url也可以保持正常
 this.$router.push({name:"Search",query:{keyword:this.keyword},params:{keyword:''||undefined}})

```

* 路由组件能不能传递props数据？

答： 可以，有三种写法，需要在路由器中配置

`src/router/index.js`

```js
        {
            name: 'Search',
            path: '/search/:keyWord?',
            component: Search,
            meta: {isShowFooter: true},
            // 路由组件可以传递props数据
            // 1.对象写法 额外给路由组件传递一些props
            // props: {a: 1, b: 'hello'},
            // 2.布尔值写法 如果为true，会把传的params以props形式接收
            // props: true,
            // 3.函数写法 可以把params参数、query参数通过props传递给路由组件
            props: ($route) => {
                return {
                    keyWord: $route.params.keyWord,
                    k: $route.query.k
                }
            }
        },
```

## 7.2 传参方法

* 字符串形式

```js
this.$router.push('/search/' + params传的参数 + '?k=' + query传的参数)
```

* 模板字符串

```js
this.$router.push(`/search/${this.params传的参数}?k=${this.query传的参数}`)
```

**注意**： 上面字符串的传参方法可以看出params参数和’/'结合，query参数和？结合
`http://localhost:8080/#/search/asd?keyword=asd`
上面url可以看出，asd为params的值，keyword=asd为query传递的值

* 对象（常用）

```js
      this.$router.push({
        name: '路由名字',
        params: {传的参数},
        query: {传的参数}
      })
```

**注意：**以对象方式传参时，如果我们传参中使用了params，只能使用name，不能使用path，如果只是使用query传参，可以使用path 

<img src="/Users/chenzhengqing/Library/Application Support/typora-user-images/image-20230421165927432.png" alt="image-20230421165927432" style="zoom:50%;" />

# 8. 多次执行相同的push问题

多次执行相同的push问题，控制台会发生警告

例如：使用`this.$router.push({name:‘Search’,params:{keyword:“…”||undefined}})`时，如果多次执行相同的push，控制台会出现警告

我们尝试将其打印：

`src/components/Header/index.vue`

```js
let result = this.$router.push({
		name:"Search",
		query:{keyword:this.keyword}
})
console.log(result)
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/d7b3e04b2986474d8009fe970b7b2e63.png)

多次执行则会出现警告

![在这里插入图片描述](https://img-blog.csdnimg.cn/308f41adccfe4268a6a2e0b4b2d2cfd0.png)

原因：push是一个`promise`，`promise`需要传递成功和失败两个参数，我们的push中没有传递。
方法：`this.$router.push({name:‘Search’,params:{keyword:“…”||undefined}},()=>{},()=>{})`后面两项分别代表执行成功和失败的回调函数。
这种写法治标不治本，将来在别的组件中push|replace,编程式导航还是会有类似错误
push是`VueRouter.prototype`的一个方法，在router中的`index.js`重写该方法即可(看不懂也没关系，这是前端面试题)

`src/router/index.js`

```js
// 先把VueRouter原型对象上的push保存一份
let originPush = VueRouter.prototype.push
let originReplace = VueRouter.prototype.replace
// 重写push|replace方法
// 第一个参数：告诉原来的push方法，往哪里跳转，传递哪些参数
// 第二个参数：成功的回调
// 第三个参数：失败的回调
VueRouter.prototype.push = function(location, resolve, reject) {
    if (resolve && reject) {
        // call/apply的区别：
        // 相同点：都可以调用函数一次，都可以篡改函数的上下文一次
        // 不同点：call与apply传递参数：call传递参数用逗号隔开，apply方法执行，传递数组
        originPush.call(this, location, resolve, reject)
    }else{
        originPush.call(this, location, () => {}, () => {})
    }
}
VueRouter.prototype.replace = function(location, resolve, reject) {
    if (resolve && reject) {
        originReplace.call(this, location, () => {}, () => {})
    }else{
        originReplace.call(this, location, () => {}, () => {})
    }
}
```

